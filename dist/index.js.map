{"version":3,"file":"index.js","sources":["../src/compressImage.js","../src/cropImage.js"],"sourcesContent":["import imageCompression from 'browser-image-compression';\n\n/**\n * Compress an image File to a target max size in MB.\n * Logs original and compressed size + dimensions.\n * \n * @param {File} file - The original image File\n * @param {number} maxSizeMB - Target max size in megabytes\n * @returns {Promise<File>} - Compressed File\n */\nexport async function compressImage(file, maxSizeMB) {\n  if (!file.type.startsWith('image/')) throw new Error('Only image files are supported');\n\n  const originalSizeMB = (file.size / 1024 / 1024).toFixed(2);\n\n  // Load original dimensions\n  const origDims = await getImageDimensions(file);\n  console.log(` Original dimensions: ${origDims.width} × ${origDims.height}, ${originalSizeMB} MB`);\n\n  // Skip if already under threshold\n  if (file.size / 1024 / 1024 <= maxSizeMB) {\n    return file;\n  }\n\n  const options = {\n    maxSizeMB,\n    useWebWorker: true,\n    maxWidthOrHeight: undefined\n  };\n\n  try {\n    const compressed = await imageCompression(file, options);\n    const compressedSizeMB = (compressed.size / 1024 / 1024).toFixed(2);\n    const compressedDims = await getImageDimensions(compressed);\n\n    console.log(`Compressed dimensions: ${compressedDims.width} × ${compressedDims.height}, ${compressedSizeMB} MB`);\n\n    return compressed;\n  } catch (err) {\n    throw err;\n  }\n}\n\n/**\n * Utility to get image dimensions from a File or Blob.\n * @param {File|Blob} file \n * @returns {Promise<{width: number, height: number}>}\n */\nfunction getImageDimensions(file) {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => {\n      resolve({ width: img.naturalWidth, height: img.naturalHeight });\n    };\n    img.onerror = reject;\n    img.src = URL.createObjectURL(file);\n  });\n}\n\n","import { compressImage } from \"./compressImage\";\n\n// Helper to wrap canvas.toBlob in a Promise\nfunction canvasToBlob(canvas, type, quality) {\n  return new Promise((resolve, reject) => {\n    canvas.toBlob(blob => {\n      if (blob) resolve(blob);\n      else reject('Canvas toBlob failed');\n    }, type, quality);\n  });\n}\n\n/**\n * Automatically crops the given File to target dimensions and returns a File.\n * Preserves the original filename.\n * Keeps image type (PNG, JPEG, etc.) for output.\n * @param {File} file - File object from the file input\n * @param {number} targetW - Target crop width\n * @param {number} targetH - Target crop height\n * @param {number} maxMbLimit - Maxximum mb limit to reduce the size (default: undefined)\n * @returns {Promise<File>} Cropped File object\n */\n\nexport async function cropImage(file, targetW, targetH, maxMbLimit) {\n  \n  if (!file.type.startsWith('image/')) throw new Error('Only image files are supported');\n\n  const img = await new Promise((resolve, reject) => {\n    const i = new Image();\n    const objectUrl = URL.createObjectURL(file);\n\n    i.onload = () => {\n      URL.revokeObjectURL(objectUrl);\n      resolve(i);\n    };\n    i.onerror = () => {\n      URL.revokeObjectURL(objectUrl);\n      reject('Image load error');\n    };\n\n    i.src = objectUrl;\n  });\n\n  const origW = img.naturalWidth;\n  const origH = img.naturalHeight;\n\n  const scale = Math.max(targetW / origW, targetH / origH);\n  const newW = Math.ceil(origW * scale);\n  const newH = Math.ceil(origH * scale);\n\n  const tempCanvas = document.createElement('canvas');\n  tempCanvas.width = newW;\n  tempCanvas.height = newH;\n  tempCanvas.getContext('2d').drawImage(img, 0, 0, newW, newH);\n\n  const cropX = Math.floor((newW - targetW) / 2);\n  const cropY = Math.floor((newH - targetH) / 2);\n\n  const outCanvas = document.createElement('canvas');\n  outCanvas.width = targetW;\n  outCanvas.height = targetH;\n  outCanvas.getContext('2d').drawImage(tempCanvas, cropX, cropY, targetW, targetH, 0, 0, targetW, targetH);\n\n  let mimeType = file.type;\n  if (!mimeType || mimeType === 'image/svg+xml') mimeType = 'image/png';\n\n  const quality = mimeType === 'image/jpeg' ? 0.9 : undefined;\n  const blob = await canvasToBlob(outCanvas, mimeType, quality);\n\n  const originalName = file.name.replace(/\\.[^/.]+$/, '');\n  const extension = mimeType.split('/')[1] || 'png';\n  const ext = extension === 'jpeg' ? 'jpg' : extension;\n\n  const croppedFile = new File([blob], `${originalName}.${ext}`, { type: mimeType });\n\n  if (maxMbLimit) {\n    return await compressImage(croppedFile, maxMbLimit);\n  }\n\n  return croppedFile;\n}\n\n\n\n\n\n\n\n\n\n\n\n\n  // export  function cropImage(file, targetW, targetH, maxMbLimit) {\n  //   return new Promise((resolve, reject) => {\n  //     const img = new Image();\n  //     const objectUrl = URL.createObjectURL(file);\n\n  //     img.onload = () => {\n  //       const origW = img.naturalWidth;\n  //       const origH = img.naturalHeight;\n\n  //       // Scale so image fully covers target crop area (cover strategy)\n  //       const scale = Math.max(targetW / origW, targetH / origH);\n  //       const newW = Math.ceil(origW * scale);\n  //       const newH = Math.ceil(origH * scale);\n\n  //       // Draw resized image on temp canvas\n  //       const tempCanvas = document.createElement('canvas');\n  //       tempCanvas.width = newW;\n  //       tempCanvas.height = newH;\n  //       const tctx = tempCanvas.getContext('2d');\n  //       tctx.drawImage(img, 0, 0, newW, newH);\n\n  //       // Crop center rectangle\n  //       const cropX = Math.floor((newW - targetW) / 2);\n  //       const cropY = Math.floor((newH - targetH) / 2);\n\n  //       const outCanvas = document.createElement('canvas');\n  //       outCanvas.width = targetW;\n  //       outCanvas.height = targetH;\n  //       const octx = outCanvas.getContext('2d');\n  //       octx.drawImage(tempCanvas, cropX, cropY, targetW, targetH, 0, 0, targetW, targetH);\n\n  //       // Determine output format and quality\n  //       let mimeType = file.type;\n  //       if (!mimeType || mimeType === 'image/svg+xml') mimeType = 'image/png';\n\n  //       // Set quality for JPEG only, else quality param ignored\n  //       const quality = mimeType === 'image/jpeg' ? 0.9 : undefined;\n\n  //       outCanvas.toBlob((blob) => {\n  //         URL.revokeObjectURL(objectUrl);\n  //         if (blob) {\n  //           // Preserve original file name & extension\n  //           const originalName = file.name.replace(/\\.[^/.]+$/, ''); // Remove extension\n  //           const extension = mimeType.split('/')[1] || 'png'; // e.g. 'jpeg', 'png'\n\n  //           // Fix extension for jpeg types\n  //           const ext = extension === 'jpeg' ? 'jpg' : extension;\n\n  //           const croppedFile = new File([blob], `${originalName}.${ext}`, { type: mimeType });\n  //           if(maxMbLimit){\n  //             try{\n  //               const compressedFile = compressImage(croppedFile, maxMbLimit)\n  //               resolve(compressedFile)\n  //             }catch(e){\n  //               reject(e)\n  //             }\n  //           }else{\n  //             resolve(croppedFile);\n  //           }\n  //         } else {\n  //           reject('Canvas toBlob failed');\n  //         }\n  //       }, mimeType, quality);\n  //     };\n\n  //     img.onerror = () => {\n  //       URL.revokeObjectURL(objectUrl);\n  //       reject('Image load error');\n  //     };\n\n  //     img.src = objectUrl;\n  //   });\n  // }"],"names":["compressImage","file","maxSizeMB","type","startsWith","Error","originalSizeMB","size","toFixed","origDims","getImageDimensions","console","log","width","height","options","useWebWorker","maxWidthOrHeight","undefined","compressed","imageCompression","compressedSizeMB","compressedDims","err","Promise","resolve","reject","img","Image","onload","naturalWidth","naturalHeight","onerror","src","URL","createObjectURL","canvasToBlob","canvas","quality","toBlob","blob","cropImage","targetW","targetH","maxMbLimit","i","objectUrl","revokeObjectURL","origW","origH","scale","Math","max","newW","ceil","newH","tempCanvas","document","createElement","getContext","drawImage","cropX","floor","cropY","outCanvas","mimeType","originalName","name","replace","extension","split","ext","croppedFile","File"],"mappings":"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"}